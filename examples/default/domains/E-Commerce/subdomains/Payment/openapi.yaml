openapi: 3.0.3
info:
  title: Payment Domain REST API
  version: 0.0.1
  description: |
    OpenAPI specification for the Payment Domain REST endpoints.
    This API provides operations for managing payments, retrieving payment status,
    and handling refunds.

servers:
  - url: https://api.example.com/v1
    description: Production server
  - url: https://staging-api.example.com/v1
    description: Staging server

paths:
  /payments:
    post:
      summary: Initiate a new payment
      operationId: createPayment
      tags:
        - Payments
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePaymentRequest'
      responses:
        '201':
          description: Payment initiated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '400':
          description: Invalid request
        '422':
          description: Payment validation failed

  /payments/{paymentId}:
    get:
      summary: Get payment details
      operationId: getPayment
      tags:
        - Payments
      parameters:
        - name: paymentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Payment details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '404':
          description: Payment not found

  /payments/{paymentId}/refund:
    post:
      summary: Request a refund for a payment
      operationId: refundPayment
      tags:
        - Refunds
      parameters:
        - name: paymentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefundRequest'
      responses:
        '200':
          description: Refund processed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Refund'
        '400':
          description: Invalid refund request
        '404':
          description: Payment not found

  /payments/{paymentId}/status:
    get:
      summary: Get payment status
      operationId: getPaymentStatus
      tags:
        - Payments
      parameters:
        - name: paymentId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Payment status retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentStatus'
        '404':
          description: Payment not found

components:
  schemas:
    CreatePaymentRequest:
      type: object
      required:
        - orderId
        - amount
        - currency
        - paymentMethod
      properties:
        orderId:
          type: string
          format: uuid
          description: The order this payment is for
        amount:
          type: number
          format: float
          minimum: 0.01
          description: Payment amount
        currency:
          type: string
          pattern: '^[A-Z]{3}$'
          description: ISO 4217 currency code
        paymentMethod:
          $ref: '#/components/schemas/PaymentMethod'

    Payment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        orderId:
          type: string
          format: uuid
        amount:
          type: number
          format: float
        currency:
          type: string
        status:
          type: string
          enum: [pending, processing, completed, failed, refunded]
        paymentMethod:
          $ref: '#/components/schemas/PaymentMethod'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PaymentMethod:
      type: object
      required:
        - type
      properties:
        type:
          type: string
          enum: [credit_card, debit_card, paypal, bank_transfer]
        cardLast4:
          type: string
          pattern: '^\d{4}$'
        cardBrand:
          type: string
          enum: [visa, mastercard, amex, discover]

    PaymentStatus:
      type: object
      properties:
        paymentId:
          type: string
          format: uuid
        status:
          type: string
          enum: [pending, processing, completed, failed, refunded]
        lastUpdated:
          type: string
          format: date-time

    RefundRequest:
      type: object
      required:
        - amount
        - reason
      properties:
        amount:
          type: number
          format: float
          minimum: 0.01
        reason:
          type: string
          maxLength: 500

    Refund:
      type: object
      properties:
        id:
          type: string
          format: uuid
        paymentId:
          type: string
          format: uuid
        amount:
          type: number
          format: float
        status:
          type: string
          enum: [pending, completed, failed]
        reason:
          type: string
        createdAt:
          type: string
          format: date-time
