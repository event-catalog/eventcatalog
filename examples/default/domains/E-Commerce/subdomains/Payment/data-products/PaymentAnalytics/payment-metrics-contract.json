{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Payment Metrics Contract",
  "description": "Schema for the fact_payments table containing transaction-level payment data",
  "type": "object",
  "required": ["payment_id", "order_id", "customer_id", "payment_timestamp", "gross_amount", "currency"],
  "properties": {
    "payment_id": {
      "type": "string",
      "description": "Unique identifier for the payment transaction"
    },
    "order_id": {
      "type": "string",
      "description": "Associated order identifier"
    },
    "customer_id": {
      "type": "string",
      "description": "Customer identifier"
    },
    "payment_timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when payment was initiated"
    },
    "gross_amount": {
      "type": "number",
      "description": "Gross payment amount before fees"
    },
    "currency": {
      "type": "string",
      "minLength": 3,
      "maxLength": 3,
      "description": "ISO 4217 currency code"
    },
    "net_amount": {
      "type": ["number", "null"],
      "description": "Net amount after fees"
    },
    "fee_amount": {
      "type": ["number", "null"],
      "description": "Processing fees"
    },
    "payment_method": {
      "type": ["string", "null"],
      "enum": ["credit_card", "debit_card", "paypal", "apple_pay", "google_pay", "bank_transfer", "crypto"],
      "description": "Payment method used"
    },
    "card_brand": {
      "type": ["string", "null"],
      "enum": ["visa", "mastercard", "amex", "discover", null],
      "description": "Card brand if card payment"
    },
    "card_last_four": {
      "type": ["string", "null"],
      "pattern": "^[0-9]{4}$",
      "description": "Last four digits of card number"
    },
    "is_recurring": {
      "type": "boolean",
      "default": false,
      "description": "Whether this is a recurring payment"
    },
    "gateway": {
      "type": ["string", "null"],
      "description": "Payment gateway used (stripe, paypal, adyen)"
    },
    "status": {
      "type": "string",
      "enum": ["pending", "authorized", "captured", "failed", "refunded", "disputed"],
      "description": "Current payment status"
    },
    "failure_reason": {
      "type": ["string", "null"],
      "description": "Reason for payment failure if applicable"
    },
    "risk_score": {
      "type": ["number", "null"],
      "minimum": 0,
      "maximum": 100,
      "description": "Fraud risk score (0-100)"
    },
    "fraud_check_result": {
      "type": ["string", "null"],
      "enum": ["pass", "review", "reject", null],
      "description": "Result of fraud check"
    },
    "is_flagged_fraud": {
      "type": "boolean",
      "default": false,
      "description": "Whether transaction was flagged as potentially fraudulent"
    },
    "is_confirmed_fraud": {
      "type": "boolean",
      "default": false,
      "description": "Whether fraud was confirmed after investigation"
    }
  }
}
