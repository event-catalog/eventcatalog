---
import NodeGraph from '@components/MDX/NodeGraph/NodeGraph.astro';
import VisualiserLayout from '@layouts/VisualiserLayout.astro';
import { buildUrl } from '@utils/url-builder';
import { getDomains } from '@utils/collections/domains';
import { ClientRouter } from 'astro:transitions';

const domains = await getDomains({ getAllVersions: false });
const docsUrl =
  domains.length > 0
    ? buildUrl(`/docs/domains/${domains[0].data.id}/${domains[0].data.latestVersion}`)
    : buildUrl('/discover/domains');
---

<VisualiserLayout title={`Visualiser | Domain Architecture`} description="High-level view of all domains and their relationships">
  <div class="m-4">
    <div
      class="h-[calc(100vh-130px)] w-full relative border border-[rgb(var(--ec-page-border))] rounded-md"
      id="domains-canvas-portal"
      transition:animate="fade"
    >
    </div>
    <NodeGraph
      id="domains-canvas"
      collection="domains-canvas"
      title="Domain Integration Map"
      mode="full"
      linkTo="visualiser"
      version="1.0.0"
      linksToVisualiser={false}
      href={{
        label: 'View Documentation',
        url: docsUrl,
      }}
    />
  </div>
  <ClientRouter />
</VisualiserLayout>
